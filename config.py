# config.py
import os
from dotenv import load_dotenv # –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —á–∏—Ç–∞—Ç—å .env —Ñ–∞–π–ª

load_dotenv() # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
BOT_TOKEN = os.getenv("BOT_TOKEN")

# ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
# os.getenv("ADMIN_IDS", "") - –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –∏–∑ .env.
# .split(',') - —Ä–∞–∑–¥–µ–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –ø–æ –∑–∞–ø—è—Ç—ã–º, –ø–æ–ª—É—á–∞—è —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ['682496357', '987654321']).
# map(int, ...) - –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É –≤ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ.
# list(...) - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç map –≤ –æ–±—ã—á–Ω—ã–π —Å–ø–∏—Å–æ–∫.
# –ï—Å–ª–∏ ADMIN_IDS –Ω–µ—Ç –≤ .env, —Ç–æ os.getenv –≤–µ—Ä–Ω–µ—Ç –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É, –∏ list(map...) —Å–æ–∑–¥–∞—Å—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫, —á—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ.
ADMIN_IDS = list(map(int, os.getenv("ADMIN_IDS", "").split(',')))

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
DATABASE_NAME = os.getenv("DATABASE_NAME", "orders_bot.db") # –ï—Å–ª–∏ DATABASE_NAME –Ω–µ—Ç –≤ .env, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ, –º–æ–≥—É—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤ –∫–æ–¥–µ)
import logging
LOGGING_LEVEL = logging.INFO # –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ logging.DEBUG –¥–ª—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

ORDERS_PER_PAGE = int(os.getenv("ORDERS_PER_PAGE", 10)) # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º 10 –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
MAX_PREVIEW_TEXT_LENGTH = int(os.getenv("MAX_PREVIEW_TEXT_LENGTH", 30))

# –ö–∞—Ä—Ç–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤
# –ö–ª—é—á - —Å–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è —Å—Ç–∞—Ç—É—Å–∞ (–æ–¥–Ω–æ—Å–ª–æ–≤–Ω–æ–µ, –±–µ–∑ –Ω–∏–∂–Ω–∏—Ö –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–π), –ó–Ω–∞—á–µ–Ω–∏–µ - –∫—Ä–∞—Å–∏–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
ORDER_STATUS_MAP = {
    'new': '–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ üìù',
    'stockcheck': '–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ üîç',
    'confirmed': '–ù–∞–ª–∏—á–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, –æ–ø–ª–∞—Ç–∞ üí∞',
    'paid': '–û–ø–ª–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞ ‚úÖ',
    'tosupplier': '–ü–µ—Ä–µ–¥–∞–µ–º –ø–æ—Å—Ç–∞–≤—â–∏–∫—É ‚û°Ô∏è',
    'awaitingship': '–û–∂–∏–¥–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ —Å–∫–ª–∞–¥–∞ üì¶',
    'shipped': '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω —Å–æ —Å–∫–ª–∞–¥–∞ üöö',
    'intransit': '–í –ø—É—Ç–∏ –∫ –ø–æ–ª—É—á–∞—Ç–µ–ª—é üõ£Ô∏è',
    'onhold': '–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚è∏Ô∏è',
    'delivered': '–î–æ—Å—Ç–∞–≤–ª–µ–Ω üéâ',
    'cancelled': '–û—Ç–º–µ–Ω–µ–Ω ‚ùå',
    'returned': '–í–æ–∑–≤—Ä–∞—â–µ–Ω üîô'
}

# –°—Ç–∞—Ç—É—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è "–∞–∫—Ç–∏–≤–Ω—ã–º–∏" –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –µ–≥–æ –∏—Å—Ç–æ—Ä–∏–∏)
# –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–µ, –æ–¥–Ω–æ—Å–ª–æ–≤–Ω—ã–µ –∫–ª—é—á–∏
ACTIVE_ORDER_STATUSES = [
    'new',
    'stockcheck',
    'confirmed',
    'paid',
    'tosupplier',
    'awaitingship',
    'shipped',
    'intransit',
    'onhold',
]

DISPLAY_FIELD_NAMES = {
    'order_text': '—Ç–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞',  # –î–æ–±–∞–≤–∏–º –∏ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –∑–∞–∫–∞–∑–∞, —Ö–æ—Ç—å –æ–Ω –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
    'full_name': '–ø–æ–ª–Ω–æ–µ –∏–º—è',
    'delivery_address': '–∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',
    'payment_method': '—Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã',  # –î–æ–±–∞–≤–∏–º –∏ –¥–ª—è —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã
    'contact_phone': '–∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω',
    'delivery_notes': '–ø—Ä–∏–º–µ—á–∞–Ω–∏—è –∫ –¥–æ—Å—Ç–∞–≤–∫–µ'
}

# –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –±–æ–ª–µ–µ –æ–±—â–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
# –§–æ—Ä–º–∞—Ç: + (–æ—Ç 1 –¥–æ 3 —Ü–∏—Ñ—Ä) (–æ—Ç 7 –¥–æ 15 —Ü–∏—Ñ—Ä)
PHONE_NUMBER_REGEX = r"^+\d{11}$"

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
# –≠—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –ø–æ–ª–µ–π, –∏—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫,
# —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ FSM-—Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Ç–∏–ø–∞ –≤–≤–æ–¥–∞.
ORDER_FIELDS_CONFIG = [
    {
        "key": "order_text",
        "prompt": "–í–≤–µ–¥–∏—Ç–µ –∑–∞–∫–∞–∑: üìù",
        "state_name": "waiting_for_order_text", # –ò–º—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ OrderStates
        "next_field": "full_name",
        "input_type": "text"
    },
    {
        "key": "full_name",
        "prompt": "–¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏ —Å–≤–æ—ë **–ø–æ–ª–Ω–æ–µ –∏–º—è** (–§–ò–û) üë§:",
        "state_name": "waiting_for_full_name",
        "next_field": "delivery_address",
        "input_type": "text"
    },
    {
        "key": "delivery_address",
        "prompt": "–£–∫–∞–∂–∏ **–∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏** (–≥–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞) üè†:",
        "state_name": "waiting_for_delivery_address",
        "next_field": "payment_method",
        "input_type": "text"
    },
    {
        "key": "payment_method",
        "prompt": "–ö–∞–∫ —Ç—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—à—å **–æ–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑**? üí≥",
        "state_name": "waiting_for_payment_method",
        "next_field": "contact_phone",
        "input_type": "buttons", # –¢–∏–ø –≤–≤–æ–¥–∞ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        "options": { # –û–ø—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
            "–ù–∞–ª–∏—á–Ω—ã–µ üí∞": "–ù–∞–ª–∏—á–Ω—ã–µ",
            "–ö–∞—Ä—Ç–æ–π –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ üí≥": "–ö–∞—Ä—Ç–æ–π –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏"
        }
    },
    {
        "key": "contact_phone",
        "prompt": (
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à **–∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω** –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. "
            "–§–æ—Ä–º–∞—Ç: `+–•–•–•XXXXXXXXX` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `+380991234567` –∏–ª–∏ `+12125550123`)."
        ),
        "state_name": "waiting_for_contact_phone",
        "next_field": "delivery_notes",
        "input_type": "contact_button" # –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∏–ø –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞
    },
    {
        "key": "delivery_notes",
        "prompt": "–ï—Å–ª–∏ –µ—Å—Ç—å **–ø—Ä–∏–º–µ—á–∞–Ω–∏—è –∫ –¥–æ—Å—Ç–∞–≤–∫–µ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–¥–æ–º–æ—Ñ–æ–Ω 123'), –Ω–∞–ø–∏—à–∏ –∏—Ö. –ï—Å–ª–∏ –Ω–µ—Ç, –º–æ–∂–µ—à—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `-` –∏–ª–∏ `–Ω–µ—Ç` üí¨:",
        "state_name": "waiting_for_delivery_notes",
        "next_field": "final_confirm", # –ó–∞–≤–µ—Ä—à–∞—é—â–∏–π —à–∞–≥ –ø–µ—Ä–µ–¥ —Å–≤–æ–¥–∫–æ–π
        "input_type": "text"
    }
]

# –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ–ª—è –ø–æ –µ–≥–æ –∫–ª—é—á—É
ORDER_FIELD_MAP = {field["key"]: field for field in ORDER_FIELDS_CONFIG}