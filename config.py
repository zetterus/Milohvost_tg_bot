import os
import logging
import re  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º re –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π

from dotenv import load_dotenv

load_dotenv()

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ ---
BOT_TOKEN = os.getenv("BOT_TOKEN")

# ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
# ADMIN_IDS: —Å–ø–∏—Å–æ–∫ —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏—Ö Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.
# –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è ADMIN_IDS –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏–ª–∏ –ø—É—Å—Ç–∞, —Å–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –ø—É—Å—Ç—ã–º.
ADMIN_IDS = list(map(int, filter(None, os.getenv("ADMIN_IDS", "").split(','))))

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ---
DATABASE_NAME = os.getenv("DATABASE_NAME", "orders_bot.db")

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è ---
LOGGING_LEVEL = logging.INFO  # –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: INFO, DEBUG, WARNING, ERROR, CRITICAL

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ ---
ORDERS_PER_PAGE = int(os.getenv("ORDERS_PER_PAGE", 10))  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
MAX_PREVIEW_TEXT_LENGTH = int(
    os.getenv("MAX_PREVIEW_TEXT_LENGTH", 30))  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ –∑–∞–∫–∞–∑–∞ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞

# --- –ö–∞—Ä—Ç–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤ ---
# –ö–ª—é—á: —Å–∏—Å—Ç–µ–º–Ω–æ–µ –∏–º—è —Å—Ç–∞—Ç—É—Å–∞ (–æ–¥–Ω–æ—Å–ª–æ–≤–Ω–æ–µ).
# –ó–Ω–∞—á–µ–Ω–∏–µ: –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
ORDER_STATUS_MAP = {
    'new': '–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ üìù',
    'stockcheck': '–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ üîç',
    'confirmed': '–ù–∞–ª–∏—á–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, –æ–ø–ª–∞—Ç–∞ üí∞',
    'paid': '–û–ø–ª–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞ ‚úÖ',
    'tosupplier': '–ü–µ—Ä–µ–¥–∞–µ–º –ø–æ—Å—Ç–∞–≤—â–∏–∫—É ‚û°Ô∏è',
    'awaitingship': '–û–∂–∏–¥–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ —Å–∫–ª–∞–¥–∞ üì¶',
    'shipped': '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω —Å–æ —Å–∫–ª–∞–¥–∞ üöö',
    'intransit': '–í –ø—É—Ç–∏ –∫ –ø–æ–ª—É—á–∞—Ç–µ–ª—é üõ£Ô∏è',
    'onhold': '–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚è∏Ô∏è',
    'delivered': '–î–æ—Å—Ç–∞–≤–ª–µ–Ω üéâ',
    'cancelled': '–û—Ç–º–µ–Ω–µ–Ω ‚ùå',
    'returned': '–í–æ–∑–≤—Ä–∞—â–µ–Ω üîô'
}

# –°—Ç–∞—Ç—É—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è "–∞–∫—Ç–∏–≤–Ω—ã–º–∏" –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –µ–≥–æ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤)
ACTIVE_ORDER_STATUSES = [
    'new',
    'stockcheck',
    'confirmed',
    'paid',
    'tosupplier',
    'awaitingship',
    'shipped',
    'intransit',
    'onhold',
]

# –û—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π –∑–∞–∫–∞–∑–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
DISPLAY_FIELD_NAMES = {
    'order_text': '—Ç–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞',
    'full_name': '–ø–æ–ª–Ω–æ–µ –∏–º—è',
    'delivery_address': '–∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',
    'payment_method': '—Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã',
    'contact_phone': '–∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω',
    'delivery_notes': '–ø—Ä–∏–º–µ—á–∞–Ω–∏—è –∫ –¥–æ—Å—Ç–∞–≤–∫–µ'
}

# –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
# ^ - –Ω–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏
# \+? - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∑–Ω–∞–∫ "+" (–Ω–æ–ª—å –∏–ª–∏ –æ–¥–Ω–æ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ)
# \d{10,11} - —Ä–æ–≤–Ω–æ 10 –∏–ª–∏ 11 —Ü–∏—Ñ—Ä
# $ - –∫–æ–Ω–µ—Ü —Å—Ç—Ä–æ–∫–∏
PHONE_NUMBER_REGEX = re.compile(r"^\+?\d{11,12}$")

# --- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ ---
# –≠—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –ø–æ–ª–µ–π, –∏—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫,
# —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ FSM-—Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Ç–∏–ø–∞ –≤–≤–æ–¥–∞.
# 'next_field' –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å 'key' —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–ª—è –∏–ª–∏ –±—ã—Ç—å 'final_confirm'
ORDER_FIELDS_CONFIG = [
    {
        "key": "order_text",
        "prompt": "–í–≤–µ–¥–∏—Ç–µ –∑–∞–∫–∞–∑: üìù",
        "state_name": "waiting_for_order_text",
        "next_field": "full_name",
        "input_type": "text"
    },
    {
        "key": "full_name",
        "prompt": "–¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏ —Å–≤–æ—ë **–ø–æ–ª–Ω–æ–µ –∏–º—è** (–§–ò–û) üë§:",
        "state_name": "waiting_for_full_name",
        "next_field": "delivery_address",
        "input_type": "text"
    },
    {
        "key": "delivery_address",
        "prompt": "–£–∫–∞–∂–∏ **–∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏** (–≥–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞) üè†:",
        "state_name": "waiting_for_delivery_address",
        "next_field": "payment_method",
        "input_type": "text"
    },
    {
        "key": "payment_method",
        "prompt": "–ö–∞–∫ —Ç—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—à—å **–æ–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑**? üí≥",
        "state_name": "waiting_for_payment_method",
        "next_field": "contact_phone",
        "input_type": "buttons",
        "options": {
            "–ù–∞–ª–∏—á–Ω—ã–µ üí∞": "–ù–∞–ª–∏—á–Ω—ã–µ",
            "–ö–∞—Ä—Ç–æ–π –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ üí≥": "–ö–∞—Ä—Ç–æ–π –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏"
        }
    },
    {
        "key": "contact_phone",
        "prompt": (
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à **–∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω** –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. "
            "–§–æ—Ä–º–∞—Ç: `+<–∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã><–Ω–æ–º–µ—Ä>` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `+380991234567`, `380998644567`, `80991238947` –∏–ª–∏ `+12125550123`)."
        ),
        "state_name": "waiting_for_contact_phone",
        "next_field": "delivery_notes",
        "input_type": "contact_button"
    },
    {
        "key": "delivery_notes",
        "prompt": "–ï—Å–ª–∏ –µ—Å—Ç—å **–ø—Ä–∏–º–µ—á–∞–Ω–∏—è –∫ –¥–æ—Å—Ç–∞–≤–∫–µ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–¥–æ–º–æ—Ñ–æ–Ω 123'), –Ω–∞–ø–∏—à–∏ –∏—Ö. –ï—Å–ª–∏ –Ω–µ—Ç, –º–æ–∂–µ—à—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `-` –∏–ª–∏ `–Ω–µ—Ç` üí¨:",
        "state_name": "waiting_for_delivery_notes",
        "next_field": "final_confirm",
        "input_type": "text"
    }
]

# –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ–ª—è –ø–æ –µ–≥–æ –∫–ª—é—á—É
ORDER_FIELD_MAP = {field["key"]: field for field in ORDER_FIELDS_CONFIG}
